<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Explore Projects - Projexia</title>
    <link rel="stylesheet" href="/css/common.css" />
    <link rel="stylesheet" href="/css/modal.css" />
    <link rel="stylesheet" href="/css/headerAndNavigationBar.css" />
    <link rel="stylesheet" href="/css/footer.css" />
    <link rel="stylesheet" href="/css/home.css" />
  </head>
  <body>
    <%- include('headerAndNavigationBar') %>
    
    <main class="projects-main">

      <!-- Filter Container -->
      <div id="filterContainer">
        <input 
          type="text" 
          id="searchProject" 
          class="filter" 
          placeholder="Search project name..." 
          autocomplete="off"
        />

        <select class="filter" id="filterProgram" name="filterProgram">
          <option value="All">All Programs</option>
          <option value="BSIT">BSIT</option>
          <option value="BSIS">BSIS</option>
          <option value="BSCS">BSCS</option>
        </select>

        <select class="filter" id="filterYear" name="filterYear">
          <option value="All">All Years</option>
          <option value="1st">1st Year</option>
          <option value="2nd">2nd Year</option>
          <option value="3rd">3rd Year</option>
          <option value="4th">4th Year</option>
        </select>

        <select class="filter" id="filterTechnology" name="filterTechnology">
          <option value="All">All Technologies</option>
        </select>
      </div>

      <!-- Section 1: Weekly Top 3 Projects -->
      <% if (weeklyTop3 && weeklyTop3.length > 0) { %>
      <section class="section-top3">
        <div class="section-header">
          <h2 class="section-title">
            <svg class="trending-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
              <polyline points="17 6 23 6 23 12"></polyline>
            </svg>
            ðŸ”¥ Top 3 Trending
          </h2>
          <p class="section-subtitle">The 3 most popular projects</p>
        </div>

        <div class="top3-container">
          <% weeklyTop3.forEach((project, index) => { %>
            <a href="/project/<%= project.id %>" class="project-link top3-link">
              <div class="project top3-project" 
                   data-program="<%= project.program %>" 
                   data-year="<%= project.year %>"
                   data-technologies="<%= project.technologies.join(',') %>"
                   data-project-name="<%= project.projectName.toLowerCase() %>"
                   data-popularity="<%= project.popularity %>">

                <!-- Thumbnail -->
                <img src="<%= project.projectThumbnail %>" alt="<%= project.projectName %>">

                <!-- Project Name -->
                <h3><%= project.projectName %></h3>

                <!-- Technologies -->
                <div class="tech-list">
                  <% project.technologies.forEach(tech => { %>
                    <p class="tech-item"><%= tech %></p>
                  <% }) %>
                </div>

                <!-- Stats -->
                <div class="project-stats">
                  <div class="stat-item">
                    <svg class="stat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                    </svg>
                    <span class="stat-count"><%= project.likeCount %></span>
                  </div>
                  
                  <div class="stat-item">
                    <svg class="stat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                    </svg>
                    <span class="stat-count"><%= project.commentCount %></span>
                  </div>
                  
                  <div class="stat-item">
                    <svg class="stat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                      <circle cx="12" cy="12" r="3"></circle>
                    </svg>
                    <span class="stat-count"><%= project.viewCount %></span>
                  </div>
                </div>

                <!-- Popularity Score -->
                <div class="popularity-badge">
                  <svg class="fire-icon" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2c1.5 3 4 4 6 4 0 5-3 8-6 12-3-4-6-7-6-12 2 0 4.5-1 6-4z"/>
                  </svg>
                  <span><%= project.popularity %> popularity</span>
                </div>
              </div>
            </a>
          <% }) %>
        </div>
      </section>
      <% } %>

      <!-- Section 2: Batchmate Projects -->
      <% if (currentUser && batchmateProjects && batchmateProjects.length > 0) { %>
      <section class="section-batchmates">
        <div class="section-header">
          <h2 class="section-title">
            <svg class="batchmate-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
              <circle cx="9" cy="7" r="4"></circle>
              <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
              <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg>
            Your Batchmates' Projects
          </h2>
          <p class="section-subtitle"><%= currentUser.year %> Year - <%= currentUser.program %></p>
        </div>

        <div class="batchmate-container">
          <% batchmateProjects.forEach(project => { %>
            <a href="/project/<%= project.id %>" class="project-link">
              <div class="project" 
                   data-program="<%= project.program %>" 
                   data-year="<%= project.year %>"
                   data-technologies="<%= project.technologies.join(',') %>"
                   data-project-name="<%= project.projectName.toLowerCase() %>"
                   data-popularity="<%= project.popularity %>">

                <img src="<%= project.projectThumbnail %>" alt="<%= project.projectName %>">
                <h3><%= project.projectName %></h3>

                <div class="tech-list">
                  <% project.technologies.forEach(tech => { %>
                    <p class="tech-item"><%= tech %></p>
                  <% }) %>
                </div>

                <div class="project-stats">
                  <div class="stat-item">
                    <svg class="stat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                    </svg>
                    <span class="stat-count"><%= project.likeCount %></span>
                  </div>
                  
                  <div class="stat-item">
                    <svg class="stat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                    </svg>
                    <span class="stat-count"><%= project.commentCount %></span>
                  </div>
                  
                  <div class="stat-item">
                    <svg class="stat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                      <circle cx="12" cy="12" r="3"></circle>
                    </svg>
                    <span class="stat-count"><%= project.viewCount %></span>
                  </div>
                </div>
              </div>
            </a>
          <% }) %>
        </div>
      </section>
      <% } %>

      <!-- Section 3: All Other Projects -->
      <% if (remainingProjects && remainingProjects.length > 0) { %>
      <section class="section-all">
        <div class="section-header">
          <h2 class="section-title">
            <svg class="all-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="3" width="7" height="7"></rect>
              <rect x="14" y="3" width="7" height="7"></rect>
              <rect x="14" y="14" width="7" height="7"></rect>
              <rect x="3" y="14" width="7" height="7"></rect>
            </svg>
            Discover More Projects
          </h2>
          <p class="section-subtitle">Explore all other amazing projects</p>
        </div>

        <div class="all-projects-container">
          <% remainingProjects.forEach(project => { %>
            <a href="/project/<%= project.id %>" class="project-link">
              <div class="project" 
                   data-program="<%= project.program %>" 
                   data-year="<%= project.year %>"
                   data-technologies="<%= project.technologies.join(',') %>"
                   data-project-name="<%= project.projectName.toLowerCase() %>"
                   data-popularity="<%= project.popularity %>">

                <img src="<%= project.projectThumbnail %>" alt="<%= project.projectName %>">
                <h3><%= project.projectName %></h3>

                <div class="tech-list">
                  <% project.technologies.forEach(tech => { %>
                    <p class="tech-item"><%= tech %></p>
                  <% }) %>
                </div>

                <div class="project-stats">
                  <div class="stat-item">
                    <svg class="stat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                    </svg>
                    <span class="stat-count"><%= project.likeCount %></span>
                  </div>
                  
                  <div class="stat-item">
                    <svg class="stat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                    </svg>
                    <span class="stat-count"><%= project.commentCount %></span>
                  </div>
                  
                  <div class="stat-item">
                    <svg class="stat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                      <circle cx="12" cy="12" r="3"></circle>
                    </svg>
                    <span class="stat-count"><%= project.viewCount %></span>
                  </div>
                </div>
              </div>
            </a>
          <% }) %>
        </div>
      </section>
      <% } %>

    </main>

    <%- include('partials/footer') %>
    
    <!-- Socket.IO Client -->
    <script src="/socket.io/socket.io.js"></script>
    <% if (locals.currentUser) { %>
    <script>
      const USER_ID = "<%= currentUser._id || '' %>";
    </script>
    <% } %>
    
    <script src="/js/modal.js"></script>
    <script src="/js/config.js"></script>
    <script src="/js/headerAndNavigationBar.js"></script>
    <script src="/js/footer.js"></script>
    <script src="/js/home.js"></script>
  </body>
</html>

<!-- Footer Component -->
<footer class="footer">
  <div class="footer-container">
    <!-- Footer Grid -->
    <div class="footer-grid">
      <!-- Brand Section -->
      <div class="footer-col span-2">
        <div class="footer-brand-section">
          <h3>
            <span class="brand-span-primary">Proje</span><span class="brand-span-secondary">X</span><span class="brand-span-primary">ia</span>
          </h3>
          <p>The premier platform for College of Computer Studies students to showcase their innovative projects 
              and connect with the academic community.</p>
        </div>

        <!-- Support & Contact Links (Horizontal) -->
        <div class="footer-support-and-contact" style="margin-top: 1.5rem; display: grid; grid-template-columns: auto auto; gap: 3rem;">
          <div>
            <h4>Support</h4>
            <div class="footer-links">
              <a href="/donate" class="footer-link">Donate</a>
              <% if (typeof user !== 'undefined' && user) { %>
                <a href="/report" class="footer-link">Report Issue</a>
              <% } else { %>
                <a href="/signin" class="footer-link">Report Issue</a>
              <% } %>
            </div>
          </div>
          <div>
            <h4>Contact</h4>
            <div class="footer-links" style="display: flex; flex-direction: column; gap: 0.5rem;">
              <a href="mailto:contact@projexia.dev" class="footer-link" style="display: flex; align-items: center; gap: 0.5rem;">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="2" y="4" width="20" height="16" rx="2"></rect>
                  <path d="m22 7-10 5L2 7"></path>
                </svg>
                <span>contact@projexia.dev</span>
              </a>
              <a href="tel:+1234567890" class="footer-link" style="display: flex; align-items: center; gap: 0.5rem;">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                </svg>
                <span>+1 (234) 567-890</span>
              </a>
            </div>
          </div>
        </div>
      </div>

      <!-- Rating & Feedback Section -->
      <div class="footer-col">
        <div class="footer-feedback-section-compact">
          <!-- Average Rating Display (Always visible) -->
          <div class="rating-display" id="ratingDisplay">
            <div class="avg-rating">
              <span class="avg-rating-value" id="avgRatingValue">-</span>
              <span class="avg-rating-label">/ 5.0</span>
            </div>
            <p class="rating-count">User Experience Rating</p>
          </div>

          <% if (user) { %>
            <!-- Rating Form (Only for logged-in users) -->
            <div class="rating-form-compact">
              <div id="ratingStarsCompact" class="rating-stars-compact" style="justify-content: center;">
                <% for (let i = 1; i <= 5; i++) { %>
                  <button class="star-btn-compact" data-rating="<%= i %>" type="button" aria-label="Rate <%= i %> stars">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                      <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path>
                    </svg>
                  </button>
                <% } %>
              </div>
              
              <textarea 
                id="feedbackTextCompact" 
                class="input" 
                placeholder="Share your feedback..." 
                rows="2"
                maxlength="500"
              ></textarea>
              <div class="char-count-compact">
                <span id="charCountCompact">0</span>/500
              </div>

              <button id="feedbackSubmitCompact" class="btn btn-sm btn-primary" style="width: 100%; margin-top: 0.5rem;">Submit Rating</button>
              <div id="feedbackMessageCompact" class="feedback-message"></div>
            </div>
          <% } %>
        </div>
      </div>
    </div>

    <!-- Footer Bottom -->
    <div class="footer-bottom">
      <!-- Statistics Section -->
      <div class="footer-stats-section" id="footerStats">
        <div class="footer-stat">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
            <circle cx="9" cy="7" r="4"></circle>
            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
          </svg>
          <span id="userCount">Loading...</span> Students
        </div>
        <div class="footer-stat">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">  
            <polyline points="12 3 20 7.5 20 16.5 12 21 4 16.5 4 7.5 12 3"></polyline>
            <line x1="12" y1="12" x2="20" y2="7.5"></line>
            <line x1="12" y1="12" x2="12" y2="21"></line>
            <line x1="12" y1="12" x2="4" y2="7.5"></line>
          </svg>
          <span id="projectCount">Loading...</span> Projects
        </div>

        <p class="footer-credit">
          Made with 
          <svg class="footer-credit-icon" viewBox="0 0 24 24" fill="currentColor" stroke="none">
            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
          </svg>
          by CCS Students
        </p>
      </div>
    </div>

    <!-- Footer Script -->
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        loadFooterStatistics();
        loadAverageRating();
        setupRatingSystemCompact();
        setupFeedbackFormCompact();
        setupRatingSystem();
        setupFeedbackForm();
      });

      // Load statistics from database
      function loadFooterStatistics() {
        fetch('/api/footer/statistics')
          .then(res => res.json())
          .then(data => {
            document.getElementById('userCount').textContent = data.userCount.toLocaleString();
            document.getElementById('projectCount').textContent = data.projectCount.toLocaleString();
          })
          .catch(error => {
            console.error('Error loading statistics:', error);
            document.getElementById('userCount').textContent = '0';
            document.getElementById('projectCount').textContent = '0';
          });
      }

      // Load average rating
      function loadAverageRating() {
        fetch('/api/footer/average-rating')
          .then(res => res.json())
          .then(data => {
            const avgRating = data.averageRating ? parseFloat(data.averageRating).toFixed(1) : '-';
            if (document.getElementById('avgRatingValue')) {
              document.getElementById('avgRatingValue').textContent = avgRating;
            }
            
            if (data.totalRatings > 0 && document.getElementById('ratingCount')) {
              document.getElementById('ratingCount').textContent = `${data.totalRatings} ${data.totalRatings === 1 ? 'rating' : 'ratings'}`;
            }
          })
          .catch(error => console.error('Error loading rating:', error));
      }

      // Setup compact star rating system (in footer grid)
      function setupRatingSystemCompact() {
        const starsCompact = document.querySelectorAll('.star-btn-compact');
        let selectedRatingCompact = 0;

        starsCompact.forEach(star => {
          star.addEventListener('click', function() {
            selectedRatingCompact = parseInt(this.dataset.rating);
            updateStarDisplayCompact(selectedRatingCompact);
          });

          star.addEventListener('mouseover', function() {
            updateStarDisplayCompact(parseInt(this.dataset.rating));
          });
        });

        const ratingStarsCompactEl = document.getElementById('ratingStarsCompact');
        if (ratingStarsCompactEl) {
          ratingStarsCompactEl.addEventListener('mouseleave', function() {
            updateStarDisplayCompact(selectedRatingCompact);
          });
        }

        function updateStarDisplayCompact(rating) {
          starsCompact.forEach((star, index) => {
            if (index < rating) {
              star.classList.add('active');
            } else {
              star.classList.remove('active');
            }
          });
        }

        window.getSelectedRatingCompact = () => selectedRatingCompact;
      }

      // Setup compact feedback form (in footer grid)
      function setupFeedbackFormCompact() {
        const textareaCompact = document.getElementById('feedbackTextCompact');
        const charCountCompact = document.getElementById('charCountCompact');
        const submitBtnCompact = document.getElementById('feedbackSubmitCompact');
        const messageCompact = document.getElementById('feedbackMessageCompact');

        if (!textareaCompact) return;

        // Character count
        textareaCompact.addEventListener('input', function() {
          charCountCompact.textContent = this.value.length;
        });

        // Submit feedback
        submitBtnCompact.addEventListener('click', async function() {
          const rating = window.getSelectedRatingCompact();
          const feedback = textareaCompact.value.trim();

          if (rating === 0) {
            showMessageCompact('Please select a rating', 'error');
            return;
          }

          if (feedback.length === 0) {
            showMessageCompact('Please enter your feedback', 'error');
            return;
          }

          try {
            submitBtnCompact.disabled = true;
            submitBtnCompact.textContent = 'Submitting...';

            const response = await fetch('/api/footer/submit-rating', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({
                rating: rating,
                comments: feedback
              })
            });

            if (response.ok) {
              showMessageCompact('Thank you for your feedback!', 'success');
              textareaCompact.value = '';
              charCountCompact.textContent = '0';
              document.querySelectorAll('.star-btn-compact').forEach(btn => btn.classList.remove('active'));
              window.selectedRatingCompact = 0;
              
              // Reload average rating
              setTimeout(loadAverageRating, 500);
            } else {
              showMessageCompact('Error submitting feedback', 'error');
            }
          } catch (error) {
            console.error('Error:', error);
            showMessageCompact('Error submitting feedback', 'error');
          } finally {
            submitBtnCompact.disabled = false;
            submitBtnCompact.textContent = 'Submit';
          }
        });

        function showMessageCompact(text, type) {
          messageCompact.textContent = text;
          messageCompact.className = `feedback-message ${type}`;
          setTimeout(() => {
            messageCompact.textContent = '';
            messageCompact.className = 'feedback-message';
          }, 4000);
        }
      }

      // Setup star rating system (in footer-bottom)
      function setupRatingSystem() {
        const stars = document.querySelectorAll('.star-btn');
        if (stars.length === 0) return;
        
        let selectedRating = 0;

        stars.forEach(star => {
          star.addEventListener('click', function() {
            selectedRating = parseInt(this.dataset.rating);
            updateStarDisplay(selectedRating);
          });

          star.addEventListener('mouseover', function() {
            updateStarDisplay(parseInt(this.dataset.rating));
          });
        });

        const ratingStarsEl = document.getElementById('ratingStars');
        if (ratingStarsEl) {
          ratingStarsEl.addEventListener('mouseleave', function() {
            updateStarDisplay(selectedRating);
          });
        }

        function updateStarDisplay(rating) {
          stars.forEach((star, index) => {
            if (index < rating) {
              star.classList.add('active');
            } else {
              star.classList.remove('active');
            }
          });
        }

        window.getSelectedRating = () => selectedRating;
      }

      // Setup feedback form (in footer-bottom)
      function setupFeedbackForm() {
        const textarea = document.getElementById('feedbackText');
        if (!textarea) return;
        
        const charCount = document.getElementById('charCount');
        const submitBtn = document.getElementById('feedbackSubmit');
        const message = document.getElementById('feedbackMessage');

        // Character count
        textarea.addEventListener('input', function() {
          charCount.textContent = this.value.length;
        });

        // Submit feedback
        submitBtn.addEventListener('click', async function() {
          const rating = window.getSelectedRating();
          const feedback = textarea.value.trim();

          if (rating === 0) {
            showMessage('Please select a rating', 'error');
            return;
          }

          if (feedback.length === 0) {
            showMessage('Please enter your feedback', 'error');
            return;
          }

          try {
            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitting...';

            const response = await fetch('/api/footer/submit-rating', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({
                rating: rating,
                comments: feedback
              })
            });

            if (response.ok) {
              showMessage('Thank you for your feedback!', 'success');
              textarea.value = '';
              charCount.textContent = '0';
              document.querySelectorAll('.star-btn').forEach(btn => btn.classList.remove('active'));
              window.selectedRating = 0;
              
              // Reload average rating
              setTimeout(loadAverageRating, 500);
            } else {
              showMessage('Error submitting feedback', 'error');
            }
          } catch (error) {
            console.error('Error:', error);
            showMessage('Error submitting feedback', 'error');
          } finally {
            submitBtn.disabled = false;
            submitBtn.textContent = 'Submit Feedback';
          }
        });

        function showMessage(text, type) {
          message.textContent = text;
          message.className = `feedback-message ${type}`;
          setTimeout(() => {
            message.textContent = '';
            message.className = 'feedback-message';
          }, 4000);
        }
      }
    </script>
  </div>
</footer>

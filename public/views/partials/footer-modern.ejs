<!-- Footer Component -->
<footer class="footer">
  <div class="footer-container">
    <!-- Footer Grid -->
    <div class="footer-grid">
      <!-- Brand Section -->
      <div class="footer-col span-2">
        <div class="footer-brand-section">
          <h3>
            <span class="brand-span-primary">Proje</span><span class="brand-span-secondary">X</span><span class="brand-span-primary">ia</span>
          </h3>
          <p>The premier platform for College of Computer Studies students to showcase their innovative projects 
              and connect with the academic community.</p>
        </div>

        <!-- Support & Contact Links (Horizontal) -->
        <div class="footer-support-and-contact" style="margin-top: 1.5rem; display: grid; grid-template-columns: auto auto; gap: 3rem;">
          <div>
            <h4>Support</h4>
            <div class="footer-links">
              <a href="/donate" class="footer-link">Donate</a>
              <a href="/faqs" class="footer-link">FAQs</a>
              <% if (typeof user !== 'undefined' && user) { %>
                <a href="/report" class="footer-link">Report Issue</a>
              <% } else { %>
                <a href="/signin" class="footer-link">Report Issue</a>
              <% } %>
            </div>
          </div>
          <div>
            <h4>Contact</h4>
            <div class="footer-links" style="display: flex; flex-direction: column; gap: 0.5rem;">
              <a href="mailto:projexiacss@gmail.com" class="footer-link" style="display: flex; align-items: center; gap: 0.5rem;">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="2" y="4" width="20" height="16" rx="2"></rect>
                  <path d="m22 7-10 5L2 7"></path>
                </svg>
                <span>projexiacss@gmail.com</span>
              </a>
              <a href="tel:+639386401063" class="footer-link" style="display: flex; align-items: center; gap: 0.5rem;">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                </svg>
                <span>+63 938 640 1063</span>
              </a>
              <a href="https://www.facebook.com/profile.php?id=61584430631441" class="footer-link" style="display: flex; align-items: center; gap: 0.5rem;" target="_blank">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"></path>
                </svg>
                <span>Projexia</span>
              </a>
            </div>
          </div>
        </div>
      </div>

      <!-- Rating & Feedback Section -->
      <div class="footer-col">
        <div class="footer-feedback-section-compact">
          <!-- Average Rating Display (Always visible) -->
          <div class="rating-display" id="ratingDisplay">
            <div class="avg-rating">
              <span class="avg-rating-value" id="avgRatingValue">-</span>
              <span class="avg-rating-label">/ 5.0</span>
            </div>
            <p class="rating-count">User Experience Rating</p>
          </div>

          <!-- Rate Your Experience Button (Only for logged-in users) -->
          <% if (typeof user !== 'undefined' && user) { %>
            <button id="openRatingModalBtn" class="btn btn-primary" style="width: 100%; margin-top: 1rem;">
              Rate Your Experience
            </button>
          <% } %>
        </div>
      </div>
    </div>

    <!-- Footer Bottom -->
    <div class="footer-bottom">
      <!-- Statistics Section -->
      <div class="footer-stats-section" id="footerStats">
        <div class="footer-stat">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
            <circle cx="9" cy="7" r="4"></circle>
            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
          </svg>
          <span id="userCount">Loading...</span> Students
        </div>
        <div class="footer-stat">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">  
            <polyline points="12 3 20 7.5 20 16.5 12 21 4 16.5 4 7.5 12 3"></polyline>
            <line x1="12" y1="12" x2="20" y2="7.5"></line>
            <line x1="12" y1="12" x2="12" y2="21"></line>
            <line x1="12" y1="12" x2="4" y2="7.5"></line>
          </svg>
          <span id="projectCount">Loading...</span> Projects
        </div>

        <p class="footer-credit">
          Made with 
          <svg class="footer-credit-icon" viewBox="0 0 24 24" fill="currentColor" stroke="none">
            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
          </svg>
          by CCS Students
        </p>
      </div>
    </div>

    <!-- Rating Modal -->
    <% if (user) { %>
      <div id="ratingModal" class="rating-modal" style="display: none;">
        <div class="rating-modal-overlay"></div>
        <div class="rating-modal-content">
          <div class="rating-modal-header">
            <h3>Rate Your Experience</h3>
            <button id="closeRatingModalBtn" class="rating-modal-close" aria-label="Close modal">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>
          </div>
          
          <div class="rating-modal-body">
            <p class="rating-modal-description">How would you rate your experience with ProjeXia?</p>
            
            <!-- Star Rating -->
            <div id="ratingStarsModal" class="rating-stars-modal">
              <% for (let i = 1; i <= 5; i++) { %>
                <button class="star-btn-modal" data-rating="<%= i %>" type="button" aria-label="Rate <%= i %> stars">
                  <svg viewBox="0 0 24 24" fill="currentColor" width="40" height="40">
                    <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path>
                  </svg>
                </button>
              <% } %>
            </div>

            <!-- Submit Button -->
            <button id="submitRatingModalBtn" class="btn btn-primary" style="width: 100%;">
              Submit Rating
            </button>
            
            <!-- Feedback Message -->
            <div id="feedbackMessageModal" class="feedback-message"></div>
          </div>
        </div>
      </div>
    <% } %>

    <!-- Footer Script -->
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        loadFooterStatistics();
        loadAverageRating();
        setupRatingModal();
      });

      // Load statistics from database
      function loadFooterStatistics() {
        fetch('/api/footer/statistics')
          .then(res => res.json())
          .then(data => {
            document.getElementById('userCount').textContent = data.userCount.toLocaleString();
            document.getElementById('projectCount').textContent = data.projectCount.toLocaleString();
          })
          .catch(error => {
            console.error('Error loading statistics:', error);
            document.getElementById('userCount').textContent = '0';
            document.getElementById('projectCount').textContent = '0';
          });
      }

      // Load average rating
      function loadAverageRating() {
        fetch('/api/footer/average-rating')
          .then(res => res.json())
          .then(data => {
            const avgRating = data.averageRating ? parseFloat(data.averageRating).toFixed(1) : '-';
            if (document.getElementById('avgRatingValue')) {
              document.getElementById('avgRatingValue').textContent = avgRating;
            }
            
            if (data.totalRatings > 0 && document.getElementById('ratingCount')) {
              document.getElementById('ratingCount').textContent = `${data.totalRatings} ${data.totalRatings === 1 ? 'rating' : 'ratings'}`;
            }
          })
          .catch(error => console.error('Error loading rating:', error));
      }

      // Setup rating modal
      function setupRatingModal() {
        const modal = document.getElementById('ratingModal');
        const openBtn = document.getElementById('openRatingModalBtn');
        const closeBtn = document.getElementById('closeRatingModalBtn');
        const overlay = document.querySelector('.rating-modal-overlay');
        const starsModal = document.querySelectorAll('.star-btn-modal');
        const submitBtn = document.getElementById('submitRatingModalBtn');
        const messageModal = document.getElementById('feedbackMessageModal');
        
        if (!modal || !openBtn) return;
        
        let selectedRating = 0;

        // Open modal
        openBtn.addEventListener('click', function() {
          modal.style.display = 'block';
          document.body.style.overflow = 'hidden';
        });

        // Close modal
        function closeModal() {
          modal.style.display = 'none';
          document.body.style.overflow = '';
          // Reset form
          selectedRating = 0;
          starsModal.forEach(star => star.classList.remove('active'));
          messageModal.textContent = '';
          messageModal.className = 'feedback-message';
        }

        closeBtn.addEventListener('click', closeModal);
        overlay.addEventListener('click', closeModal);

        // Close on Escape key
        document.addEventListener('keydown', function(e) {
          if (e.key === 'Escape' && modal.style.display === 'block') {
            closeModal();
          }
        });

        // Star rating system
        starsModal.forEach(star => {
          star.addEventListener('click', function() {
            selectedRating = parseInt(this.dataset.rating);
            updateStarDisplay(selectedRating);
          });

          star.addEventListener('mouseover', function() {
            updateStarDisplay(parseInt(this.dataset.rating));
          });
        });

        const ratingStarsModalEl = document.getElementById('ratingStarsModal');
        if (ratingStarsModalEl) {
          ratingStarsModalEl.addEventListener('mouseleave', function() {
            updateStarDisplay(selectedRating);
          });
        }

        function updateStarDisplay(rating) {
          starsModal.forEach((star, index) => {
            if (index < rating) {
              star.classList.add('active');
            } else {
              star.classList.remove('active');
            }
          });
        }

        // Submit rating
        submitBtn.addEventListener('click', async function() {
          if (selectedRating === 0) {
            showMessage('Please select a rating', 'error');
            return;
          }

          try {
            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitting...';

            const response = await fetch('/api/footer/submit-rating', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({
                rating: selectedRating
              })
            });

            const data = await response.json();

            if (response.ok) {
              showMessage('Thank you for your rating!', 'success');
              
              // Reload average rating
              setTimeout(() => {
                loadAverageRating();
                closeModal();
              }, 1500);
            } else {
              showMessage(data.message || 'Error submitting rating', 'error');
            }
          } catch (error) {
            console.error('Error:', error);
            showMessage('Error submitting rating', 'error');
          } finally {
            submitBtn.disabled = false;
            submitBtn.textContent = 'Submit Rating';
          }
        });

        function showMessage(text, type) {
          messageModal.textContent = text;
          messageModal.className = `feedback-message ${type}`;
          setTimeout(() => {
            if (type !== 'success') {
              messageModal.textContent = '';
              messageModal.className = 'feedback-message';
            }
          }, 4000);
        }
      }
    </script>
  </div>
</footer>

<!DOCTYPE html>
<html lang="en">
  <head> 
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><%= project.name %> - Projexia</title>
    <link rel="stylesheet" href="/css/common.css" />
    <link rel="stylesheet" href="/css/headerAndNavigationBar.css" />
    <link rel="stylesheet" href="/css/footer.css" />
    <link rel="stylesheet" href="/css/modal.css" />
    <link rel="stylesheet" href="/css/projectDetails.css" />
  </head>
  <body>
    <%- include('headerAndNavigationBar') %>
    
    <main class="projectDetails">
      <!-- Project Header Section -->
      <section class="project-header">
        <div class="project-thumbnail">
          <img src="<%= project.thumbnailUrl?.url %>" alt="<%= project.name %>" />

        </div>
         
        <div class="project-info">
          <h1 class="project-title"><%= project.name %></h1>
          
          <div class="project-meta">
            <div class="uploader-info">
              <a href="/visit/profile/<%= uploader._id %>"><span class="uploader-name"><%= uploader.fullName %></span></a>
              <span class="uploader-details"><%= uploader.program %> - <%= uploader.year %> Year</span>
            </div>
            <div class="upload-date">
              Uploaded on <%= new Date(project.createdAt).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) %>
            </div>
          </div>

          <div class="project-stats">
            <div class="stat-item">
              <svg class="stat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
              </svg>
              <span class="stat-count"><%= likeCount %></span>
              <span class="stat-label">Likes</span>
            </div>
            
            <div class="stat-item">
              <svg class="stat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
              </svg>
              <span class="stat-count"><%= commentCount %></span>
              <span class="stat-label">Comments</span>
            </div>
            
            <div class="stat-item">
              <svg class="stat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                <circle cx="12" cy="12" r="3"></circle>
              </svg>
              <span class="stat-count"><%= viewCount %></span>
              <span class="stat-label">Views</span>
            </div>
          </div>

          <% if (isUploader) { %>
            <div class="uploader-actions">
              <button class="btn-edit-project" id="openEditModal">
                <svg class="edit-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                  <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                </svg>
                Edit Project
              </button>
              <button class="btn-delete-project" data-project-id="<%= project._id %>">
                <svg class="delete-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="3 6 5 6 21 6"></polyline>
                  <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                </svg>
                Delete Project
              </button>
            </div>
          <% } %>

          <!-- Edit Modal -->
          <% if (isUploader) { %>
            <div id="editModal" class="modal">
              <div class="modal-content">
                <div class="modal-header">
                  <h2>Edit Project</h2>
                  <span class="modal-close">&times;</span>
                </div>
                
                <form id="editProjectForm">
                  <div class="form-group">
                    <label for="editDescription">Description</label>
                    <textarea 
                      id="editDescription" 
                      name="description" 
                      rows="5" 
                      required
                    ><%= project.description %></textarea>
                  </div>

                  <div class="form-group">
                    <label for="editGithubLink">GitHub Link</label>
                    <input 
                      type="url" 
                      id="editGithubLink" 
                      name="githubLink" 
                      value="<%= project.githubLink || '' %>"
                      placeholder="https://github.com/username/repo"
                    />
                  </div>

                  <div class="form-group">
                    <label for="editWebsiteLink">Website Link</label>
                    <input 
                      type="url" 
                      id="editWebsiteLink" 
                      name="websiteLink" 
                      value="<%= project.websiteLink || '' %>"
                      placeholder="https://yourproject.com"
                    />
                  </div>

                  <div class="modal-footer">
                    <button type="button" class="btn-cancel" id="cancelEdit">Cancel</button>
                    <button type="submit" class="btn-save">Save Changes</button>
                  </div>
                </form>
              </div>
            </div>
          <% } %>
        </div>
      </section>

      <!-- Project Description -->
      <section class="project-description">
        <h2>About This Project</h2>
        <p><%= project.description %></p>
      </section>

      <!-- Technologies Used -->
      <section class="project-technologies">
        <h2>Technologies Used</h2>
        <div class="tech-tags">
          <% project.technologies.forEach(tech => { %>
            <span class="tech-tag"><%= tech %></span>
          <% }); %>
        </div>
      </section>

      <!-- Developers -->
      <section class="project-developers">
        <h2>Developers</h2>
        <div class="developers-list">
          <% project.developers.forEach(developer => { %>
            <div class="developer-card">
              <div class="developer-avatar">
                <%= developer.charAt(0).toUpperCase() %>
              </div>
              <span class="developer-name"><%= developer %></span>
            </div>
          <% }); %>
        </div>
      </section>

      <!-- Project Links -->
      <section class="project-links">
        <h2>Project Links</h2>
        <div class="links-container">
          <% if (project.githubLink) { %>
            <a href="<%= project.githubLink %>" target="_blank" rel="noopener noreferrer" class="project-link github-link">
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
              </svg>
              View on GitHub
            </a>
          <% } %>
          
          <% if (project.websiteLink) { %>
            <a href="<%= project.websiteLink %>" target="_blank" rel="noopener noreferrer" class="project-link website-link">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="2" y1="12" x2="22" y2="12"></line>
                <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
              </svg>
              Visit Website
            </a>
          <% } %>
        </div>
      </section>

      <!-- Other Images Gallery -->
        <% if (project.otherImages && project.otherImages.length > 0) { %>
          <section class="project-gallery">
            <h2>Project Gallery</h2>
            <div class="gallery-grid">

              <% project.otherImages.forEach((image, index) => { %>
                <div class="gallery-item">
                  <img 
                    src="<%= image.url %>" 
                    alt="<%= project.name %> screenshot <%= index + 1 %>" 
                    loading="lazy" 
                  />
                </div>
              <% }) %>

            </div>
          </section>
        <% } %>


      <!-- Comments Section -->
      <section class="project-comments">
        <h2>Comments (<span id="commentCount"><%= commentCount %></span>)</h2>
        
        <div class="comment-form">
          <textarea id="commentInput" placeholder="Write a comment..." rows="3"></textarea>
          <button id="submitComment" class="btn-submit-comment">Post Comment</button>
        </div>

        <div class="comments-list" id="commentsList">
          <% comments.forEach(comment => { %>
            <div class="comment-item" id="comment-<%= comment._id %>">
              <div class="comment-avatar">
                <%= comment.userId.fullName.charAt(0).toUpperCase() %>
              </div>
              <div class="comment-content">
                <div class="comment-header">
                  <span class="comment-author"><%= comment.userId.fullName %></span>
                  <span class="comment-meta"><%= comment.userId.program %> - <%= comment.userId.year %> Year</span>
                  <span class="comment-date"><%= new Date(comment.createdAt).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) %></span>
                  
                  <% if (currentUserId && (currentUserId.toString() === comment.userId._id.toString() || isUploader)) { %>
                    <button class="btn-delete-comment" data-comment-id="<%= comment._id %>">Delete</button>
                  <% } %>
                </div>
                <p class="comment-text"><%= comment.text %></p>
              </div>
            </div>
          <% }); %>
        </div>
      </section>

      <!-- Like Button (Floating Action Button) -->
      <button id="likeButton" class="btn-like <%= hasLiked ? 'liked' : '' %>" data-project-id="<%= project._id %>">
        <svg class="like-icon" viewBox="0 0 24 24" fill="<%= hasLiked ? 'currentColor' : 'none' %>" stroke="currentColor" stroke-width="2">
          <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
        </svg>
      </button>
    </main>

    <%- include('partials/footer') %>
    <script src="/js/config.js"></script>
    <script src="/js/modal.js"></script>
    <script src="/js/headerAndNavigationBar.js"></script>
    <script src="/js/footer.js"></script>
    <script src="/js/projectDetails.js"></script>
  </body>
</html>